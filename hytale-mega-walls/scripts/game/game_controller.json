{
  "name": "MegaWalls_GameController",
  "description": "Main game controller for Mega Walls",
  "version": "1.0",
  "variables": [
    {
      "name": "game_phase",
      "type": "integer",
      "default": 0,
      "description": "0=Lobby, 1=Prep, 2=Deathmatch, 3=Ended"
    },
    {
      "name": "prep_timer",
      "type": "integer",
      "default": 1200,
      "description": "Preparation phase timer (20 minutes in seconds)"
    },
    {
      "name": "team_red_alive",
      "type": "boolean",
      "default": true
    },
    {
      "name": "team_blue_alive",
      "type": "boolean",
      "default": true
    },
    {
      "name": "team_green_alive",
      "type": "boolean",
      "default": true
    },
    {
      "name": "team_yellow_alive",
      "type": "boolean",
      "default": true
    },
    {
      "name": "walls_are_up",
      "type": "boolean",
      "default": true
    },
    {
      "name": "winner_team",
      "type": "string",
      "default": ""
    }
  ],
  "graphs": [
    {
      "name": "Game_Initialize",
      "trigger": "on_game_start",
      "nodes": [
        {
          "id": 1,
          "type": "event",
          "event": "on_game_start",
          "output": 2
        },
        {
          "id": 2,
          "type": "set_variable",
          "variable": "game_phase",
          "value": 1,
          "output": 3
        },
        {
          "id": 3,
          "type": "set_variable",
          "variable": "prep_timer",
          "value": 1200,
          "output": 4
        },
        {
          "id": 4,
          "type": "set_variable",
          "variable": "team_red_alive",
          "value": true,
          "output": 5
        },
        {
          "id": 5,
          "type": "set_variable",
          "variable": "team_blue_alive",
          "value": true,
          "output": 6
        },
        {
          "id": 6,
          "type": "set_variable",
          "variable": "team_green_alive",
          "value": true,
          "output": 7
        },
        {
          "id": 7,
          "type": "set_variable",
          "variable": "team_yellow_alive",
          "value": true,
          "output": 8
        },
        {
          "id": 8,
          "type": "set_variable",
          "variable": "walls_are_up",
          "value": true,
          "output": 9
        },
        {
          "id": 9,
          "type": "broadcast_message",
          "message": "=== MEGA WALLS ===",
          "output": 10
        },
        {
          "id": 10,
          "type": "broadcast_message",
          "message": "Preparation Phase: 20 minutes",
          "output": 11
        },
        {
          "id": 11,
          "type": "broadcast_message",
          "message": "Gather resources and prepare for battle!"
        }
      ]
    },
    {
      "name": "Prep_Phase_Timer",
      "trigger": "on_timer",
      "interval": 1.0,
      "nodes": [
        {
          "id": 1,
          "type": "event",
          "event": "on_timer",
          "interval": 1.0,
          "output": 2
        },
        {
          "id": 2,
          "type": "get_variable",
          "variable": "game_phase",
          "output_value": "phase",
          "output": 3
        },
        {
          "id": 3,
          "type": "branch",
          "condition": "phase == 1",
          "true_output": 4,
          "false_output": null,
          "comment": "Only run during prep phase"
        },
        {
          "id": 4,
          "type": "get_variable",
          "variable": "prep_timer",
          "output_value": "timer",
          "output": 5
        },
        {
          "id": 5,
          "type": "math_subtract",
          "a": "timer",
          "b": 1,
          "output_value": "new_timer",
          "output": 6
        },
        {
          "id": 6,
          "type": "set_variable",
          "variable": "prep_timer",
          "value": "new_timer",
          "output": 7
        },
        {
          "id": 7,
          "type": "branch",
          "condition": "new_timer == 300",
          "true_output": 8,
          "false_output": 9,
          "comment": "5 minute warning"
        },
        {
          "id": 8,
          "type": "broadcast_message",
          "message": "‚ö†Ô∏è 5 MINUTES until walls fall!",
          "output": 9
        },
        {
          "id": 9,
          "type": "branch",
          "condition": "new_timer == 60",
          "true_output": 10,
          "false_output": 11,
          "comment": "1 minute warning"
        },
        {
          "id": 10,
          "type": "broadcast_message",
          "message": "‚ö†Ô∏è 1 MINUTE until walls fall!",
          "output": 11
        },
        {
          "id": 11,
          "type": "branch",
          "condition": "new_timer <= 10 AND new_timer > 0",
          "true_output": 12,
          "false_output": 13,
          "comment": "Countdown"
        },
        {
          "id": 12,
          "type": "broadcast_message",
          "message": "Walls fall in {new_timer}...",
          "output": 13
        },
        {
          "id": 13,
          "type": "branch",
          "condition": "new_timer <= 0",
          "true_output": 14,
          "false_output": null
        },
        {
          "id": 14,
          "type": "call_graph",
          "graph": "Walls_Fall"
        }
      ]
    },
    {
      "name": "Walls_Fall",
      "trigger": "called",
      "nodes": [
        {
          "id": 1,
          "type": "set_variable",
          "variable": "game_phase",
          "value": 2,
          "output": 2
        },
        {
          "id": 2,
          "type": "set_variable",
          "variable": "walls_are_up",
          "value": false,
          "output": 3
        },
        {
          "id": 3,
          "type": "broadcast_message",
          "message": "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó",
          "output": 4
        },
        {
          "id": 4,
          "type": "broadcast_message",
          "message": "‚ïë  THE WALLS HAVE FALLEN! ‚ïë",
          "output": 5
        },
        {
          "id": 5,
          "type": "broadcast_message",
          "message": "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù",
          "output": 6
        },
        {
          "id": 6,
          "type": "play_sound_global",
          "sound": "walls_fall_horn",
          "volume": 2.0,
          "output": 7
        },
        {
          "id": 7,
          "type": "destroy_blocks_tagged",
          "tag": "mega_walls_wall",
          "comment": "Remove all wall blocks",
          "output": 8
        },
        {
          "id": 8,
          "type": "wait",
          "duration": 3.0,
          "output": 9
        },
        {
          "id": 9,
          "type": "spawn_entity",
          "entity_type": "dragon",
          "position": "red_dragon_spawn",
          "team": "red",
          "script": "Dragon_Boss",
          "output": 10
        },
        {
          "id": 10,
          "type": "spawn_entity",
          "entity_type": "dragon",
          "position": "blue_dragon_spawn",
          "team": "blue",
          "script": "Dragon_Boss",
          "output": 11
        },
        {
          "id": 11,
          "type": "spawn_entity",
          "entity_type": "dragon",
          "position": "green_dragon_spawn",
          "team": "green",
          "script": "Dragon_Boss",
          "output": 12
        },
        {
          "id": 12,
          "type": "spawn_entity",
          "entity_type": "dragon",
          "position": "yellow_dragon_spawn",
          "team": "yellow",
          "script": "Dragon_Boss",
          "output": 13
        },
        {
          "id": 13,
          "type": "broadcast_message",
          "message": "Dragons have spawned! Protect yours, destroy theirs!",
          "output": 14
        },
        {
          "id": 14,
          "type": "enable_pvp",
          "comment": "Turn on PvP globally"
        }
      ]
    },
    {
      "name": "Check_Win_Condition",
      "trigger": "called",
      "nodes": [
        {
          "id": 1,
          "type": "set_local_variable",
          "name": "alive_count",
          "value": 0,
          "output": 2
        },
        {
          "id": 2,
          "type": "set_local_variable",
          "name": "last_team",
          "value": "",
          "output": 3
        },
        {
          "id": 3,
          "type": "get_variable",
          "variable": "team_red_alive",
          "output_value": "red_alive",
          "output": 4
        },
        {
          "id": 4,
          "type": "branch",
          "condition": "red_alive == true",
          "true_output": 5,
          "false_output": 6
        },
        {
          "id": 5,
          "type": "set_local_variable",
          "name": "alive_count",
          "value": "alive_count + 1",
          "output": 51
        },
        {
          "id": 51,
          "type": "set_local_variable",
          "name": "last_team",
          "value": "Red",
          "output": 6
        },
        {
          "id": 6,
          "type": "get_variable",
          "variable": "team_blue_alive",
          "output_value": "blue_alive",
          "output": 7
        },
        {
          "id": 7,
          "type": "branch",
          "condition": "blue_alive == true",
          "true_output": 8,
          "false_output": 9
        },
        {
          "id": 8,
          "type": "set_local_variable",
          "name": "alive_count",
          "value": "alive_count + 1",
          "output": 81
        },
        {
          "id": 81,
          "type": "set_local_variable",
          "name": "last_team",
          "value": "Blue",
          "output": 9
        },
        {
          "id": 9,
          "type": "get_variable",
          "variable": "team_green_alive",
          "output_value": "green_alive",
          "output": 10
        },
        {
          "id": 10,
          "type": "branch",
          "condition": "green_alive == true",
          "true_output": 11,
          "false_output": 12
        },
        {
          "id": 11,
          "type": "set_local_variable",
          "name": "alive_count",
          "value": "alive_count + 1",
          "output": 111
        },
        {
          "id": 111,
          "type": "set_local_variable",
          "name": "last_team",
          "value": "Green",
          "output": 12
        },
        {
          "id": 12,
          "type": "get_variable",
          "variable": "team_yellow_alive",
          "output_value": "yellow_alive",
          "output": 13
        },
        {
          "id": 13,
          "type": "branch",
          "condition": "yellow_alive == true",
          "true_output": 14,
          "false_output": 15
        },
        {
          "id": 14,
          "type": "set_local_variable",
          "name": "alive_count",
          "value": "alive_count + 1",
          "output": 141
        },
        {
          "id": 141,
          "type": "set_local_variable",
          "name": "last_team",
          "value": "Yellow",
          "output": 15
        },
        {
          "id": 15,
          "type": "branch",
          "condition": "alive_count == 1",
          "true_output": 16,
          "false_output": null,
          "comment": "Only 1 team left = WINNER"
        },
        {
          "id": 16,
          "type": "set_variable",
          "variable": "game_phase",
          "value": 3,
          "output": 17
        },
        {
          "id": 17,
          "type": "set_variable",
          "variable": "winner_team",
          "value": "last_team",
          "output": 18
        },
        {
          "id": 18,
          "type": "broadcast_message",
          "message": "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó",
          "output": 19
        },
        {
          "id": 19,
          "type": "broadcast_message",
          "message": "‚ïë    üèÜ {last_team} TEAM WINS! üèÜ   ‚ïë",
          "output": 20
        },
        {
          "id": 20,
          "type": "broadcast_message",
          "message": "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù",
          "output": 21
        },
        {
          "id": 21,
          "type": "play_sound_global",
          "sound": "victory_fanfare",
          "volume": 2.0,
          "output": 22
        },
        {
          "id": 22,
          "type": "spawn_particles_global",
          "particle_type": "fireworks",
          "count": 500,
          "duration": 10.0,
          "output": 23
        },
        {
          "id": 23,
          "type": "wait",
          "duration": 15.0,
          "output": 24
        },
        {
          "id": 24,
          "type": "end_game",
          "return_to": "lobby"
        }
      ]
    }
  ]
}
